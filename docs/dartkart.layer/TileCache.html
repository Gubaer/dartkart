        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>TileCache class / dartkart.layer Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="dartkart.layer" data-type="TileCache">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../dartkart.layer.html">dartkart.layer</a> &rsaquo; <a href="../dartkart.layer/TileCache.html">TileCache</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../dartkart.html">dartkart</a></h2><h2><div class="icon-library"></div><a href="../dartkart.core.html">dartkart.core</a></h2><h2><div class="icon-library"></div><a href="../dartkart.geo.html">dartkart.geo</a></h2><h2><div class="icon-library"></div><a href="../dartkart.geometry.html">dartkart.geometry</a></h2><h2><div class="icon-library"></div><a href="../dartkart.layer.html">dartkart.layer</a></h2><ul class="icon">
<li><a href="../dartkart.layer/CanvasRenderer.html"><div class="icon-class"></div>CanvasRenderer</a></li>
<li><a href="../dartkart.layer/ImgGridRenderer.html"><div class="icon-class"></div>ImgGridRenderer</a></li>
<li><a href="../dartkart.layer/Layer.html"><div class="icon-class"></div>Layer</a></li>
<li><a href="../dartkart.layer/OsmTileLayer.html"><div class="icon-class"></div>OsmTileLayer</a></li>
<li><a href="../dartkart.layer/Renderer.html"><div class="icon-class"></div>Renderer</a></li>
<li><a href="../dartkart.layer/Tile.html"><div class="icon-class"></div>Tile</a></li>
<li><div class="icon-class"></div><strong>TileCache</strong></li>
<li><a href="../dartkart.layer/TileLayer.html"><div class="icon-class"></div>TileLayer</a></li>
<li><a href="../dartkart.layer/WMSLayer.html"><div class="icon-class"></div>WMSLayer</a></li>
</ul>
<h2><div class="icon-library"></div><a href="../dartkart.map.html">dartkart.map</a></h2></div>
<div class="content">
        <h2><strong>TileCache</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>An instance of this class maintains a cache of <code>ImageElement</code>s for
already downloaded map tiles.</p>
<p>The size of the cache is bound. The least recently accessed map tile
is removed from the cache first, if the upper limit of the maps size
is reached.</p>
<pre class="source">
class TileCache {

 /// default tile cache size
 static const DEFAULT_CAPACITY = 200;

 final Map&lt;String, ImageElement&gt;  _map = new Map();
 final Queue&lt;ImageElement&gt; _access = new Queue();

 final int capacity;

 /**
  * Creates the tile cache with [capacity] as upper
  * capacity limit.
  */
 TileCache({this.capacity: DEFAULT_CAPACITY});

 /**
  *  Lookup (or create) an [ImageElement] for [url].
  *
  *  If the image isn't in the cache then [onLoad] and [onError]
  *  are invoked later when the image is successfully loaded or
  *  when an error occurs respectively.
  */
 ImageElement lookup(String url, {onLoad(event), onError(event)}){
   var img = _map[url];
   if (img != null) {
     _access.remove(img);
     _access.addFirst(img);
     return img;
   }
   img = new Element.tag("img");
   _map[url] = img;
   if (_access.length &gt;= capacity) {
     _access.removeLast();
   }
   _access.addFirst(img);
   var sub1, sub2;
   cancel() =&gt; [sub1, sub2].where((s) =&gt; s!=null).forEach((s) =&gt; s.cancel());
   if (onLoad != null) {
     sub1 = img.onLoad.listen((e) {
       cancel();
       onLoad(e);
     });
   }
   if (onError != null) {
     sub2 = img.onError.listen((e) {
       cancel();
       onError(e);
     });
   }

   //TODO: temporary- replace later
   img.onAbort.listen((e) {
     print("Image loading -&gt; aborted ...");
   });
   img.src = url;
   return img;
 }

 /**
  * Replies the tile image for [url] if it is already in the cache
  * and complete. Otherwise, returns null.
  */
 ImageElement get(String url) {
   var img = _map[url];
   if (img != null &amp;&amp; img.complete) {
     _access.remove(img);
     _access.addFirst(img);
     return img;
   } else {
     return null;
   }
 }

 /**
  * Purges [obj] from the cache.
  *
  * ## Possible values for [obj]
  * 
  * * an URL as [String]
  * * an [ImageElement]
  *
  * Otherwise throws an [ArgumentError].
  *
  * Nothing is purged from the cache if [obj] is null.
  */
 void purge(obj) {
   if (obj == null) return;
   if (obj is String) {
     obj = _map[obj];
   } else if (obj is ImageElement) {
     obj = _map.values.firstWhere((img) =&gt; img == obj);
   } else {
     throw new ArgumentError("expected a String or an ImageElement, "
         "got $obj"
     );
   }
   if (obj == null) return;
   _access.remove(obj);
   _map.remove(obj.src);
 }
}
</pre>
</div>
<div>
<h3>Static Properties</h3>
<div class="field"><h4 id="DEFAULT_CAPACITY">
<button class="show-code">Code</button>
const         <strong>DEFAULT_CAPACITY</strong> <a class="anchor-link"
            href="#DEFAULT_CAPACITY"
            title="Permalink to TileCache.DEFAULT_CAPACITY">#</a>
        </h4>
        <div class="doc">
<p>default tile cache size</p>
<pre class="source">
static const DEFAULT_CAPACITY = 200
</pre>
</div>
</div>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="TileCache">
<button class="show-code">Code</button>
new <strong>TileCache</strong>({<a href="http://api.dartlang.org/dart_core/int.html">int</a> capacity: DEFAULT_CAPACITY}) <a class="anchor-link" href="#TileCache"
              title="Permalink to TileCache.TileCache">#</a></h4>
<div class="doc">
<p>Creates the tile cache with 
<span class="param">capacity</span> as upper
capacity limit.</p>
<pre class="source">
TileCache({this.capacity: DEFAULT_CAPACITY});
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="capacity">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/int.html">int</a>         <strong>capacity</strong> <a class="anchor-link"
            href="#capacity"
            title="Permalink to TileCache.capacity">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final int capacity
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="get">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_html/ImageElement.html">ImageElement</a> <strong>get</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> url) <a class="anchor-link" href="#get"
              title="Permalink to TileCache.get">#</a></h4>
<div class="doc">
<p>Replies the tile image for 
<span class="param">url</span> if it is already in the cache
and complete. Otherwise, returns null.</p>
<pre class="source">
ImageElement get(String url) {
 var img = _map[url];
 if (img != null &amp;&amp; img.complete) {
   _access.remove(img);
   _access.addFirst(img);
   return img;
 } else {
   return null;
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="lookup">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_html/ImageElement.html">ImageElement</a> <strong>lookup</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> url, {onLoad(event), onError(event)}) <a class="anchor-link" href="#lookup"
              title="Permalink to TileCache.lookup">#</a></h4>
<div class="doc">
<p> Lookup (or create) an <code>ImageElement</code> for 
<span class="param">url</span>.</p>
<p> If the image isn't in the cache then 
<span class="param">onLoad</span> and 
<span class="param">onError</span>
 are invoked later when the image is successfully loaded or
 when an error occurs respectively.</p>
<pre class="source">
ImageElement lookup(String url, {onLoad(event), onError(event)}){
 var img = _map[url];
 if (img != null) {
   _access.remove(img);
   _access.addFirst(img);
   return img;
 }
 img = new Element.tag("img");
 _map[url] = img;
 if (_access.length &gt;= capacity) {
   _access.removeLast();
 }
 _access.addFirst(img);
 var sub1, sub2;
 cancel() =&gt; [sub1, sub2].where((s) =&gt; s!=null).forEach((s) =&gt; s.cancel());
 if (onLoad != null) {
   sub1 = img.onLoad.listen((e) {
     cancel();
     onLoad(e);
   });
 }
 if (onError != null) {
   sub2 = img.onError.listen((e) {
     cancel();
     onError(e);
   });
 }

 //TODO: temporary- replace later
 img.onAbort.listen((e) {
   print("Image loading -&gt; aborted ...");
 });
 img.src = url;
 return img;
}
</pre>
</div>
</div>
<div class="method"><h4 id="purge">
<button class="show-code">Code</button>
void <strong>purge</strong>(obj) <a class="anchor-link" href="#purge"
              title="Permalink to TileCache.purge">#</a></h4>
<div class="doc">
<p>Purges 
<span class="param">obj</span> from the cache.</p>
<h2>Possible values for 
<span class="param">obj</span></h2><ul><li>an URL as <code>String</code></li><li>an <code>ImageElement</code></li></ul>
<p>Otherwise throws an <code>ArgumentError</code>.</p>
<p>Nothing is purged from the cache if 
<span class="param">obj</span> is null.</p>
<pre class="source">
void purge(obj) {
 if (obj == null) return;
 if (obj is String) {
   obj = _map[obj];
 } else if (obj is ImageElement) {
   obj = _map.values.firstWhere((img) =&gt; img == obj);
 } else {
   throw new ArgumentError("expected a String or an ImageElement, "
       "got $obj"
   );
 }
 if (obj == null) return;
 _access.remove(obj);
 _map.remove(obj.src);
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-06-02 17:31:28.023</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
