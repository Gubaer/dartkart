        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>SimpleFeatureLayer class / dartkart.layer Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="dartkart.layer" data-type="SimpleFeatureLayer">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../dartkart.layer.html">dartkart.layer</a> &rsaquo; <a href="../dartkart.layer/SimpleFeatureLayer.html">SimpleFeatureLayer</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../dartkart.html">dartkart</a></h2><h2><div class="icon-library"></div><a href="../dartkart.core.html">dartkart.core</a></h2><h2><div class="icon-library"></div><a href="../dartkart.geo.html">dartkart.geo</a></h2><h2><div class="icon-library"></div><a href="../dartkart.geometry.html">dartkart.geometry</a></h2><h2><div class="icon-library"></div><a href="../dartkart.layer.html">dartkart.layer</a></h2><ul class="icon">
<li><a href="../dartkart.layer/CanvasRenderer.html"><div class="icon-class"></div>CanvasRenderer</a></li>
<li><a href="../dartkart.layer/ImgGridRenderer.html"><div class="icon-class"></div>ImgGridRenderer</a></li>
<li><a href="../dartkart.layer/Layer.html"><div class="icon-class"></div>Layer</a></li>
<li><a href="../dartkart.layer/OsmTileLayer.html"><div class="icon-class"></div>OsmTileLayer</a></li>
<li><a href="../dartkart.layer/Renderer.html"><div class="icon-class"></div>Renderer</a></li>
<li><div class="icon-class"></div><strong>SimpleFeatureLayer</strong></li>
<li><a href="../dartkart.layer/Tile.html"><div class="icon-class"></div>Tile</a></li>
<li><a href="../dartkart.layer/TileCache.html"><div class="icon-class"></div>TileCache</a></li>
<li><a href="../dartkart.layer/TileLayer.html"><div class="icon-class"></div>TileLayer</a></li>
<li><a href="../dartkart.layer/TileUrlBuilder.html"><div class="icon-interface"></div>TileUrlBuilder</a></li>
<li><a href="../dartkart.layer/WMSLayer.html"><div class="icon-class"></div>WMSLayer</a></li>
</ul>
<h2><div class="icon-library"></div><a href="../dartkart.map.html">dartkart.map</a></h2></div>
<div class="content">
        <h2><strong>SimpleFeatureLayer</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>SimpleFeatureLayer renders a a collection of <code>Geometry</code> or <code>Feature</code>s
as SVG.</p>
<h2>Example</h2>
<p>[:
  m = new MapViewport("#sample-map");
  var layer = new SimpleFeatureLayer();
  m.addLayer(layer);
  // load the world countries
  HttpRequest.getString(</p>
<pre><code>"/your/relative/url/countries.geo.json"
</code></pre>
<p>  ).then((content) {</p>
<pre><code>var countries = parseGeoJson(content);
layer.data  = countries;
</code></pre>
<p>  });
:]</p>
<pre class="source">
class SimpleFeatureLayer extends Layer {

 @override
 SimpleFeatureLayer([String domId]) : super(domId){
   _scaffold();
 }

 static const _TEMPLATE = """
 &lt;!-- the root svg node - covers the whole map viewport --&gt;
 &lt;svg class="geojson-layer-root viewport" width="100%" height="100%"&gt;
   &lt;!-- representing the zoom plane - x,y, width,height are set dynamically --&gt;
   &lt;svg class="zoom-plane"&gt;
     &lt;!-- the map plane - the viewBox is set dynamically. SVG elements are
          added here --&gt;
     &lt;svg class="map-plane" width="100%" height="100%"&gt;
     &lt;/svg&gt;
   &lt;/svg&gt;
 &lt;/svg&gt;
 """;

 SvgElement _root;
 var _data;

 _scaffold() {
    _root = new SvgElement.svg(_TEMPLATE);
 }

 @override
 attach(MapViewport map) {
   super.attach(map);
   var size = map.viewportSize;
   _container.children.clear();
   _container.children.add(_root);
 }

 /**
  * Sets the data to be rendered.
  *
  * [data] is either
  * * a [Geometry] or a [Feature]
  * * a [GeometryCollection] or a [FeatureCollection]
  *
  * If [data] is null, nothing is rendered.
  */
 set data(data) {
   if (data == null) {
     _data = data;
     _root.query(".map-plane").children.clear();
     return;
   }
   _data = data;
   _root.query(".map-plane").children
     ..clear()
     ..add(_buildSvg(_data));
 }

 @override
 render() {

   // set the coordinate system for the map-plane
   var b = map.crs.projectedBounds;
   var viewBox = "${b.min.x} ${b.min.y} ${b.width} ${b.height}";
   _root.query(".map-plane").attributes["viewBox"] = viewBox;

   var zp = map.zoomPlaneSize;
   _root.query(".zoom-plane")
     ..attributes["width"] = zp.x.toString()
     ..attributes["height"] = zp.y.toString();

   // place the zoom-plane "behind" the map viewport
   var zpCenter = map.mapToZoomPlane(map.earthToMap(map.center));
   var size = map.viewportSize;
   var x = -(zpCenter.x - size.x ~/ 2).toInt();
   var y = -(zpCenter.y - size.y ~/ 2).toInt();
   _root.query(".zoom-plane")
     ..attributes["x"] = x.toString()
     ..attributes["y"] = y.toString();
 }

 //TODO:  the _build_* methods should be factored out in a renderer
 // class which is controlled by rendering rules. The SVG elements
 // should be decorated with appropriate styles and/or classes.

 SvgElement _buildSvg(data) {
   if (data is Point) return _buildSvg_Point(data);
   if (data is MultiPoint) return _buildSvg_MultiPoint(data);
   if (data is LineString) return _buildSvg_LineString(data);
   if (data is Polygon) return _buildSvg_Polygon(data);
   if (data is Feature) return _buildSvg(data.geometry);
   if (data is FeatureCollection) return _buildSvg_FeatureCollection(data);
   if (data is GeometryCollection) return _buildSvg_GeometryCollection(data);
 }

 _buildSvg_FeatureCollection(FeatureCollection fc) {
   var svgs = fc.features.map((f) =&gt; _buildSvg(f.geometry)).toList();
   svgs.remove(null);
   var g = new SvgElement.tag("g");
   g.classes.add("sf-feature-collection");
   g.children.addAll(svgs);
   return g;
 }

 _buildSvg_GeometryCollection(GeometryCollection c) {
   var svgs = c.geometries.map((g) =&gt; _buildSvg(g)).toList();
   svgs.remove(null);
   var g = new SvgElement.tag("g");
   g.classes.add("sf-geometry-collection");
   g.children.addAll(svgs);
   return g;
 }

 SvgElement _buildSvg_Point(Point g){
   return null;
 }

 SvgElement _buildSvg_MultiPoint(MultiPoint g) {
   return null;
 }

 SvgElement _buildSvg_LineString(LineString g) {

   buildLinearRing() {
     var svg = new SvgElement.tag("path");
     svg.classes.add("sf-linear-ring");
     var sb = new StringBuffer();
     for (int i=0; i&lt; g.length-1; i++) {
       var p = g[i];
       p = map.earthToMap(new LatLon(p.y, p.x));
       sb.write(i == 0 ? " M" : " L");
       sb.write(p.x.toString());
       sb.write(" ");
       sb.write((-p.y).toString());
     }
     sb.write(" Z"); // close the path
     svg.attributes["d"] = sb.toString();
     return svg;
   }

   buildLineString() {
     var svg = new SvgElement.tag("path");
     svg.classes.add(g.isLine ? "sf-line" : "sf-line-string");
     var sb = new StringBuffer();
     for (int i=0; i&lt; g.length; i++) {
       var p = g[i];
       p = map.earthToMap(new LatLon(p.y, p.x));
       sb.write(i == 0 ? "M" : "L");
       sb.write(p.x.toString());
       sb.write(" ");
       sb.write((-p.y).toString());
     }
     svg.attributes["d"] = sb.toString();
     return svg;
   }

   if (g.isLinearRing) {
     return buildLinearRing();
   } else {
     return buildLineString();
   }

 }

 SvgElement _buildSvg_Polygon(Polygon g) {
   var group = new SvgElement.tag("g");
   group.classes.add("sf-polygon");
   var exterior = _buildSvg_LineString(g.exteriorRing);
   exterior.classes.add("sf-exterior-ring");
   group.children.add(exterior);
   for (int i=0; i&lt; g.numInteriorRing; i++) {
     var interior = _buildSvg_LineString(g.interiorRingN(i));
     interior.classes.add("sf-interior-ring");
     group.children.add(interior);
   }
   return group;
 }
}
</pre>
</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../dartkart.layer/Layer.html">Layer</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>SimpleFeatureLayer</strong></span></p>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="SimpleFeatureLayer">
<button class="show-code">Code</button>
new <strong>SimpleFeatureLayer</strong>([<a href="http://api.dartlang.org/dart_core/String.html">String</a> domId]) <a class="anchor-link" href="#SimpleFeatureLayer"
              title="Permalink to SimpleFeatureLayer.SimpleFeatureLayer">#</a></h4>
<div class="doc">
<pre class="source">
@override
SimpleFeatureLayer([String domId]) : super(domId){
 _scaffold();
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field inherited"><h4 id="container">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_html/DivElement.html">DivElement</a>         <strong>container</strong> <a class="anchor-link"
            href="#container"
            title="Permalink to SimpleFeatureLayer.container">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>The <code>Element</code> this layer uses as container.</p>
<pre class="source">
DivElement get container =&gt; _container;
</pre>
</div>
</div>
<div class="method"><h4 id="data=">
<button class="show-code">Code</button>
<strong>set data</strong>(data) <a class="anchor-link" href="#data="
              title="Permalink to SimpleFeatureLayer.set data">#</a></h4>
<div class="doc">
<p>Sets the data to be rendered.</p>
<p>
<span class="param">data</span> is either
<em> a <code>Geometry</code> or a <code>Feature</code>
</em> a <code>GeometryCollection</code> or a <code>FeatureCollection</code></p>
<p>If 
<span class="param">data</span> is null, nothing is rendered.</p>
<pre class="source">
set data(data) {
 if (data == null) {
   _data = data;
   _root.query(".map-plane").children.clear();
   return;
 }
 _data = data;
 _root.query(".map-plane").children
   ..clear()
   ..add(_buildSvg(_data));
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="domId">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a> <strong>get domId</strong> <a class="anchor-link" href="#domId"
              title="Permalink to SimpleFeatureLayer.get domId">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>the unique layer id</p>
<pre class="source">
String get domId =&gt; _container.attributes["id"];
</pre>
</div>
</div>
<div class="method inherited"><h4 id="domId=">
<button class="show-code">Code</button>
<strong>set domId</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> value) <a class="anchor-link" href="#domId="
              title="Permalink to SimpleFeatureLayer.set domId">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>Sets the DOM  id on the layer <code>container</code>.</p>
<p>If 
<span class="param">value</span> is null or empty, sets a default id.</p>
<pre class="source">
set domId(String value) {
 if (value != null) value = value.trim();
 if (value == null || value.isEmpty) {
   value = _defaultDOMId();
 }
 _container.attributes["id"] = value;
}
</pre>
</div>
</div>
<div class="field inherited"><h4 id="id">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/int.html">int</a>         <strong>id</strong> <a class="anchor-link"
            href="#id"
            title="Permalink to SimpleFeatureLayer.id">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>replies the unique numeric id for this layer</p>
<pre class="source">
int get id =&gt; _nid;
</pre>
</div>
</div>
<div class="field inherited"><h4 id="map">
<button class="show-code">Code</button>
final <a href="../dartkart.map/MapViewport.html">MapViewport</a>         <strong>map</strong> <a class="anchor-link"
            href="#map"
            title="Permalink to SimpleFeatureLayer.map">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>the map this layer is attached to, or null</p>
<pre class="source">
MapViewport get map =&gt; _map;
</pre>
</div>
</div>
<div class="method inherited"><h4 id="name">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a> <strong>get name</strong> <a class="anchor-link" href="#name"
              title="Permalink to SimpleFeatureLayer.get name">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>the layer name</p>
<pre class="source">
String get name =&gt; _name;
</pre>
</div>
</div>
<div class="method inherited"><h4 id="name=">
<button class="show-code">Code</button>
<strong>set name</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> value) <a class="anchor-link" href="#name="
              title="Permalink to SimpleFeatureLayer.set name">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>sets the layer name. If 
<span class="param">value</span> is null or white space only,
chooses a default name.</p>
<pre class="source">
set name(String value) {
 if (value != null) value = value.trim();
 var old = _name;
 if (value == null || value.isEmpty) {
   _name = "Layer ${_nextLayerId}";
 } else {
   _name = value;
 }
 notify("name", old, _name);
}
</pre>
</div>
</div>
<div class="field inherited"><h4 id="onPropertyChanged">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_async/Stream.html">Stream</a>&lt;<a href="../dartkart.core/PropertyChangeEvent.html">PropertyChangeEvent</a>&gt;         <strong>onPropertyChanged</strong> <a class="anchor-link"
            href="#onPropertyChanged"
            title="Permalink to SimpleFeatureLayer.onPropertyChanged">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<pre class="source">
Stream&lt;PropertyChangeEvent&gt; get onPropertyChanged =&gt;
   _controller.stream;
</pre>
</div>
</div>
<div class="method inherited"><h4 id="opacity">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/double.html">double</a> <strong>get opacity</strong> <a class="anchor-link" href="#opacity"
              title="Permalink to SimpleFeatureLayer.get opacity">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>the opacity of this layer</p>
<pre class="source">
double get opacity =&gt; _opacity;
</pre>
</div>
</div>
<div class="method inherited"><h4 id="opacity=">
<button class="show-code">Code</button>
<strong>set opacity</strong>(<a href="http://api.dartlang.org/dart_core/num.html">num</a> value) <a class="anchor-link" href="#opacity="
              title="Permalink to SimpleFeatureLayer.set opacity">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>set the opacity of this layer. 
<span class="param">value</span> is a <code>num</code> in the range
(0.0 - 1.0). The lower the value, the more transparent the layer.</p>
<pre class="source">
set opacity(num value) {
 value = math.max(0, value);
 value = math.min(value, 1);
 var oldvalue = _opacity;
 this._opacity = value.toDouble();
 if (oldvalue != this._opacity) {
   notify("opacity", oldvalue, this._opacity);
   if (_map != null) {
     _map.render();
   }
 }
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="visible">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/bool.html">bool</a> <strong>get visible</strong> <a class="anchor-link" href="#visible"
              title="Permalink to SimpleFeatureLayer.get visible">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>the layer visibility</p>
<pre class="source">
bool get visible =&gt; _visible;
</pre>
</div>
</div>
<div class="method inherited"><h4 id="visible=">
<button class="show-code">Code</button>
<strong>set visible</strong>(<a href="http://api.dartlang.org/dart_core/bool.html">bool</a> value) <a class="anchor-link" href="#visible="
              title="Permalink to SimpleFeatureLayer.set visible">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>sets whether this layer is visible or not</p>
<pre class="source">
set visible(bool value) {
 var old = _visible;
 if (value != old) {
   if (_container != null) {
     _container.style.visibility =
         value ? "visible" : "hidden";
   }
   _visible = value;
   notify("visible", old, value);
 }
}
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="attach">
<button class="show-code">Code</button>
<strong>attach</strong>(<a href="../dartkart.map/MapViewport.html">MapViewport</a> map) <a class="anchor-link" href="#attach"
              title="Permalink to SimpleFeatureLayer.attach">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Attaches the layer to a map viewport <code>m</code>.</p>
<p>Throws <code>StateError</code> if this layer is already attached.</p>
<div class="docs-inherited-from">docs inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div></div>
<pre class="source">
@override
attach(MapViewport map) {
 super.attach(map);
 var size = map.viewportSize;
 _container.children.clear();
 _container.children.add(_root);
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="detach">
<button class="show-code">Code</button>
<strong>detach</strong>() <a class="anchor-link" href="#detach"
              title="Permalink to SimpleFeatureLayer.detach">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<p>Detaches this layer from the map viewport it is
currently attached to.</p>
<pre class="source">
detach(){
 _map = null;
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="notify">
<button class="show-code">Code</button>
<strong>notify</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> property, oldValue, newValue) <a class="anchor-link" href="#notify"
              title="Permalink to SimpleFeatureLayer.notify">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div><div class="doc">
<pre class="source">
notify(String property, oldValue, newValue) {
 if (oldValue == newValue) return;
 _controller.sink.add(
     new PropertyChangeEvent(this, property, oldValue,newValue)
  );
}
</pre>
</div>
</div>
<div class="method"><h4 id="render">
<button class="show-code">Code</button>
<strong>render</strong>() <a class="anchor-link" href="#render"
              title="Permalink to SimpleFeatureLayer.render">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Renders the layer.</p>
<div class="docs-inherited-from">docs inherited from <a href="../dartkart.layer/Layer.html">Layer</a> </div></div>
<pre class="source">
@override
render() {

 // set the coordinate system for the map-plane
 var b = map.crs.projectedBounds;
 var viewBox = "${b.min.x} ${b.min.y} ${b.width} ${b.height}";
 _root.query(".map-plane").attributes["viewBox"] = viewBox;

 var zp = map.zoomPlaneSize;
 _root.query(".zoom-plane")
   ..attributes["width"] = zp.x.toString()
   ..attributes["height"] = zp.y.toString();

 // place the zoom-plane "behind" the map viewport
 var zpCenter = map.mapToZoomPlane(map.earthToMap(map.center));
 var size = map.viewportSize;
 var x = -(zpCenter.x - size.x ~/ 2).toInt();
 var y = -(zpCenter.y - size.y ~/ 2).toInt();
 _root.query(".zoom-plane")
   ..attributes["x"] = x.toString()
   ..attributes["y"] = y.toString();
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-03-17 10:16:05.419</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
