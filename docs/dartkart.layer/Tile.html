        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>Tile class / dartkart.layer Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="dartkart.layer" data-type="Tile">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../dartkart.layer.html">dartkart.layer</a> &rsaquo; <a href="../dartkart.layer/Tile.html">Tile</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../dartkart.html">dartkart</a></h2><h2><div class="icon-library"></div><a href="../dartkart.core.html">dartkart.core</a></h2><h2><div class="icon-library"></div><a href="../dartkart.geo.html">dartkart.geo</a></h2><h2><div class="icon-library"></div><a href="../dartkart.geometry.html">dartkart.geometry</a></h2><h2><div class="icon-library"></div><a href="../dartkart.layer.html">dartkart.layer</a></h2><ul class="icon">
<li><a href="../dartkart.layer/CanvasRenderer.html"><div class="icon-class"></div>CanvasRenderer</a></li>
<li><a href="../dartkart.layer/ImgGridRenderer.html"><div class="icon-class"></div>ImgGridRenderer</a></li>
<li><a href="../dartkart.layer/Layer.html"><div class="icon-class"></div>Layer</a></li>
<li><a href="../dartkart.layer/OsmTileLayer.html"><div class="icon-class"></div>OsmTileLayer</a></li>
<li><a href="../dartkart.layer/Renderer.html"><div class="icon-class"></div>Renderer</a></li>
<li><a href="../dartkart.layer/SimpleFeatureLayer.html"><div class="icon-class"></div>SimpleFeatureLayer</a></li>
<li><div class="icon-class"></div><strong>Tile</strong></li>
<li><a href="../dartkart.layer/TileCache.html"><div class="icon-class"></div>TileCache</a></li>
<li><a href="../dartkart.layer/TileLayer.html"><div class="icon-class"></div>TileLayer</a></li>
<li><a href="../dartkart.layer/TileUrlBuilder.html"><div class="icon-interface"></div>TileUrlBuilder</a></li>
<li><a href="../dartkart.layer/WMSLayer.html"><div class="icon-class"></div>WMSLayer</a></li>
</ul>
<h2><div class="icon-library"></div><a href="../dartkart.map.html">dartkart.map</a></h2></div>
<div class="content">
        <h2><strong>Tile</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<pre class="source">
class Tile {
 static const LOADING = 0;
 static const READY = 1;
 static const ERROR= 2;

 final Point t;
 CanvasElement canvas;
 final TileLayer layer;
 ImageElement _img;
 int _state = LOADING;

 /**
  * Creates a tile at tile coordinates [t] = (ti, tj)
  * for the layer [layer]. It will be rendered on
  * [canvas].
  *
  */
 Tile(this.t, this.canvas, this.layer);

 /**
  * Detach the tile from the map viewport.
  *
  * A detached tile whose image becomes available isn't
  * rendered anymore.
  */
 detach() =&gt; canvas = null;

 /**
  * Trigger loading of the tile image.
  */
 load() {
    var url = layer.bindTileToUrl(t.x, t.y, layer.map.zoom);
    _img = _DEFAULT_CACHE.lookup(url,
     onLoad: (e) {
       _state = READY;
       render();
     },
     onError: (e) {
       _state = ERROR;
       render();
     }
   );
    _state = _img.complete ? READY : LOADING;
   render();
 }

 Point get topLeftInViewport =&gt;
     layer.map.zoomPlaneToViewport(t * layer.tileSize);

 renderReady() {
   if (canvas == null) return;
   var context = canvas.context2d;
   context.globalAlpha = layer.opacity;
   var tl = topLeftInViewport;
   var ts = layer.tileSize;
   context.clearRect(tl.x, tl.y, ts.x, ts.y);
   context.drawImage(_img, tl.x, tl.y);
 }

 ImageElement parentImage() {
   var z = layer.map.zoom;
   if (z == 0) return null;
   z--;
   var ti = t.x ~/ 2;
   var tj = t.y ~/ 2;
   var url = layer.bindTileToUrl(ti, tj, z);
   var img = _DEFAULT_CACHE.get(url);
   return img;
 }

 renderLoading() {
   var img = parentImage();
   if (img == null) {
     var context = canvas.context2d;
     var tl = topLeftInViewport;
     var ts = layer.tileSize;
     context.clearRect(tl.x,tl.y, ts.x /* width */, ts.y /* height */);
   } else {
     var tl = topLeftInViewport;
     var ts = layer.tileSize;
     // the quadrant of the parent tile to be rendered (scaled by 2)
     // in place of the current tile
     var src = new html.Rect(
         (t.x % 2) * ts.x ~/ 2,
         (t.y % 2) * ts.y ~/ 2,
         ts.x ~/ 2,
         ts.y ~/ 2
     );
     // the rectangle where the current tile is rendered
     var dest = new html.Rect(tl.x, tl.y, ts.x, ts.y);
     canvas.context2d.drawImageAtScale(img,dest,sourceRect:src);
   }
 }

 renderError() {
   var context = canvas.context2d;
   context.globalAlpha = layer.opacity;
   var ts = layer.tileSize;
   var tl = topLeftInViewport;
   var center = new Point(tl.x, tl.y) + (new Point(ts.x, ts.y) / 2).toInt();
   context
     ..save()
     ..strokeStyle="rgba(255,0,0,0.5)"
     ..lineWidth=10
     ..beginPath()
     ..arc(center.x, center.y, 50, 0, math.PI * 2, true)
     ..stroke()
     ..beginPath()
     ..moveTo(center.x - 30, center.y -30)
     ..lineTo(center.x + 30, center.y + 30)
     ..moveTo(center.x - 30, center.y + 30)
     ..lineTo(center.x +30 , center.y - 30)
     ..stroke()
     ..restore()
     ;
 }

 render() {
   if (canvas == null) return;
   switch(_state) {
     case LOADING: renderLoading(); break;
     case READY: renderReady(); break;
     case ERROR: renderError(); break;
   }
 }
}
</pre>
</div>
<div>
<h3>Static Properties</h3>
<div class="field"><h4 id="ERROR">
<button class="show-code">Code</button>
const         <strong>ERROR</strong> <a class="anchor-link"
            href="#ERROR"
            title="Permalink to Tile.ERROR">#</a>
        </h4>
        <div class="doc">
<pre class="source">
ERROR= 2
</pre>
</div>
</div>
<div class="field"><h4 id="LOADING">
<button class="show-code">Code</button>
const         <strong>LOADING</strong> <a class="anchor-link"
            href="#LOADING"
            title="Permalink to Tile.LOADING">#</a>
        </h4>
        <div class="doc">
<pre class="source">
LOADING = 0
</pre>
</div>
</div>
<div class="field"><h4 id="READY">
<button class="show-code">Code</button>
const         <strong>READY</strong> <a class="anchor-link"
            href="#READY"
            title="Permalink to Tile.READY">#</a>
        </h4>
        <div class="doc">
<pre class="source">
READY = 1
</pre>
</div>
</div>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="Tile">
<button class="show-code">Code</button>
new <strong>Tile</strong>(<a href="../dartkart.geometry/Point.html">Point</a> t, <a href="http://api.dartlang.org/dart_html/CanvasElement.html">CanvasElement</a> canvas, <a href="../dartkart.layer/TileLayer.html">TileLayer</a> layer) <a class="anchor-link" href="#Tile"
              title="Permalink to Tile.Tile">#</a></h4>
<div class="doc">
<p>Creates a tile at tile coordinates 
<span class="param">t</span> = (ti, tj)
for the layer 
<span class="param">layer</span>. It will be rendered on

<span class="param">canvas</span>.</p>
<pre class="source">
Tile(this.t, this.canvas, this.layer);
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="canvas">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_html/CanvasElement.html">CanvasElement</a>         <strong>canvas</strong> <a class="anchor-link"
            href="#canvas"
            title="Permalink to Tile.canvas">#</a>
        </h4>
        <div class="doc">
<pre class="source">
canvas
</pre>
</div>
</div>
<div class="field"><h4 id="layer">
<button class="show-code">Code</button>
final <a href="../dartkart.layer/TileLayer.html">TileLayer</a>         <strong>layer</strong> <a class="anchor-link"
            href="#layer"
            title="Permalink to Tile.layer">#</a>
        </h4>
        <div class="doc">
<pre class="source">
layer
</pre>
</div>
</div>
<div class="field"><h4 id="t">
<button class="show-code">Code</button>
final <a href="../dartkart.geometry/Point.html">Point</a>         <strong>t</strong> <a class="anchor-link"
            href="#t"
            title="Permalink to Tile.t">#</a>
        </h4>
        <div class="doc">
<pre class="source">
t
</pre>
</div>
</div>
<div class="field"><h4 id="topLeftInViewport">
<button class="show-code">Code</button>
final <a href="../dartkart.geometry/Point.html">Point</a>         <strong>topLeftInViewport</strong> <a class="anchor-link"
            href="#topLeftInViewport"
            title="Permalink to Tile.topLeftInViewport">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Point get topLeftInViewport =&gt;
   layer.map.zoomPlaneToViewport(t * layer.tileSize);
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="detach">
<button class="show-code">Code</button>
<strong>detach</strong>() <a class="anchor-link" href="#detach"
              title="Permalink to Tile.detach">#</a></h4>
<div class="doc">
<p>Detach the tile from the map viewport.</p>
<p>A detached tile whose image becomes available isn't
rendered anymore.</p>
<pre class="source">
detach() =&gt; canvas = null;
</pre>
</div>
</div>
<div class="method"><h4 id="load">
<button class="show-code">Code</button>
<strong>load</strong>() <a class="anchor-link" href="#load"
              title="Permalink to Tile.load">#</a></h4>
<div class="doc">
<p>Trigger loading of the tile image.</p>
<pre class="source">
load() {
  var url = layer.bindTileToUrl(t.x, t.y, layer.map.zoom);
  _img = _DEFAULT_CACHE.lookup(url,
   onLoad: (e) {
     _state = READY;
     render();
   },
   onError: (e) {
     _state = ERROR;
     render();
   }
 );
  _state = _img.complete ? READY : LOADING;
 render();
}
</pre>
</div>
</div>
<div class="method"><h4 id="parentImage">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_html/ImageElement.html">ImageElement</a> <strong>parentImage</strong>() <a class="anchor-link" href="#parentImage"
              title="Permalink to Tile.parentImage">#</a></h4>
<div class="doc">
<pre class="source">
ImageElement parentImage() {
 var z = layer.map.zoom;
 if (z == 0) return null;
 z--;
 var ti = t.x ~/ 2;
 var tj = t.y ~/ 2;
 var url = layer.bindTileToUrl(ti, tj, z);
 var img = _DEFAULT_CACHE.get(url);
 return img;
}
</pre>
</div>
</div>
<div class="method"><h4 id="render">
<button class="show-code">Code</button>
<strong>render</strong>() <a class="anchor-link" href="#render"
              title="Permalink to Tile.render">#</a></h4>
<div class="doc">
<pre class="source">
render() {
 if (canvas == null) return;
 switch(_state) {
   case LOADING: renderLoading(); break;
   case READY: renderReady(); break;
   case ERROR: renderError(); break;
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="renderError">
<button class="show-code">Code</button>
<strong>renderError</strong>() <a class="anchor-link" href="#renderError"
              title="Permalink to Tile.renderError">#</a></h4>
<div class="doc">
<pre class="source">
renderError() {
 var context = canvas.context2d;
 context.globalAlpha = layer.opacity;
 var ts = layer.tileSize;
 var tl = topLeftInViewport;
 var center = new Point(tl.x, tl.y) + (new Point(ts.x, ts.y) / 2).toInt();
 context
   ..save()
   ..strokeStyle="rgba(255,0,0,0.5)"
   ..lineWidth=10
   ..beginPath()
   ..arc(center.x, center.y, 50, 0, math.PI * 2, true)
   ..stroke()
   ..beginPath()
   ..moveTo(center.x - 30, center.y -30)
   ..lineTo(center.x + 30, center.y + 30)
   ..moveTo(center.x - 30, center.y + 30)
   ..lineTo(center.x +30 , center.y - 30)
   ..stroke()
   ..restore()
   ;
}
</pre>
</div>
</div>
<div class="method"><h4 id="renderLoading">
<button class="show-code">Code</button>
<strong>renderLoading</strong>() <a class="anchor-link" href="#renderLoading"
              title="Permalink to Tile.renderLoading">#</a></h4>
<div class="doc">
<pre class="source">
renderLoading() {
 var img = parentImage();
 if (img == null) {
   var context = canvas.context2d;
   var tl = topLeftInViewport;
   var ts = layer.tileSize;
   context.clearRect(tl.x,tl.y, ts.x /* width */, ts.y /* height */);
 } else {
   var tl = topLeftInViewport;
   var ts = layer.tileSize;
   // the quadrant of the parent tile to be rendered (scaled by 2)
   // in place of the current tile
   var src = new html.Rect(
       (t.x % 2) * ts.x ~/ 2,
       (t.y % 2) * ts.y ~/ 2,
       ts.x ~/ 2,
       ts.y ~/ 2
   );
   // the rectangle where the current tile is rendered
   var dest = new html.Rect(tl.x, tl.y, ts.x, ts.y);
   canvas.context2d.drawImageAtScale(img,dest,sourceRect:src);
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="renderReady">
<button class="show-code">Code</button>
<strong>renderReady</strong>() <a class="anchor-link" href="#renderReady"
              title="Permalink to Tile.renderReady">#</a></h4>
<div class="doc">
<pre class="source">
renderReady() {
 if (canvas == null) return;
 var context = canvas.context2d;
 context.globalAlpha = layer.opacity;
 var tl = topLeftInViewport;
 var ts = layer.tileSize;
 context.clearRect(tl.x, tl.y, ts.x, ts.y);
 context.drawImage(_img, tl.x, tl.y);
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-03-17 10:16:05.466</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
